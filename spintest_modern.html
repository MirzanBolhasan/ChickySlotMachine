<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Chickilicious Lucky Spin - Win Your Prize!</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <style>
        :root {
            --primary-color: #ffd700;
            --primary-light: #ffed4e;
            --primary-rgb: 255, 215, 0;
            --reel-bg-color: rgba(20, 20, 40, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5a3b8 0%, #e88da5 50%, #dd7a93 100%);
            min-height: 100vh;
            max-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 5px;
            margin: 0;
            position: relative;
            overflow: hidden;
            /* Better touch handling */
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        /* Animated background particles */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(var(--primary-rgb), 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 107, 107, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(78, 205, 196, 0.03) 0%, transparent 50%);
            animation: particleFloat 20s ease-in-out infinite;
            z-index: 0;
        }
        
        @keyframes particleFloat {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(30px, -30px); }
        }
        
        .container {
            max-width: 100%;
            width: 100%;
            max-height: 98vh;
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 32px;
            animation: fadeInDown 0.8s ease-out;
            display: none;
        }
        
        .header h1 {
            font-size: clamp(42px, 8vw, 64px);
            font-weight: 900;
            letter-spacing: 2px;
            margin-bottom: 8px;
            line-height: 1.3;
        }
        
        /* Animated Logo Styles */
        .animated-logo { 
            display: block;
            font-size: clamp(48px, 10vw, 80px);
            margin-bottom: 8px;
        }
        .animated-logo .char { 
            display: inline-block; 
            will-change: transform;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 50%, var(--primary-color) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 2px 8px rgba(var(--primary-rgb), 0.4));
        }
        
        .lucky-spin-text {
            display: block;
        }
        
        .lucky-spin-text .emoji {
            background: none;
            -webkit-background-clip: unset;
            -webkit-text-fill-color: unset;
            background-clip: unset;
            filter: none;
        }
        
        .lucky-spin-text .text {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 50%, var(--primary-color) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 2px 8px rgba(var(--primary-rgb), 0.4));
        }
        
        .header p {
            font-size: clamp(16px, 3vw, 22px);
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }
        
        /* Prize Legend */
        .prize-legend {
            position: relative;
            display: none;
            justify-content: center;
            align-items: center;
            gap: 32px;
            margin: 24px 0;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
            border-radius: 20px;
            border: 1px solid rgba(var(--primary-rgb), 0.2);
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .legend-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.3);
        }
        
        .legend-symbols {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .legend-symbol {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
        }
        
        .legend-symbol img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }
        
        .legend-arrow {
            color: var(--primary-color);
            font-size: 18px;
            font-weight: bold;
        }
        
        .legend-prize {
            color: var(--primary-color);
            font-size: clamp(14px, 2.5vw, 18px);
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        

        /* Full Template Mode */
        body.template-mode {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        
        body.template-mode .header {
            display: none;
        }
        
        body.template-mode .prize-legend {
            display: none;
        }
        
        body.template-mode .slot-machine {
            background: transparent;
            backdrop-filter: none;
            box-shadow: none;
            border: none;
            padding: 50px 20px;
        }
        
        body.template-mode .container {
            max-width: 100%;
        }
        

                @media (max-width: 768px) {
            .prize-legend {
                gap: 16px;
            }
            .legend-item {
                padding: 10px 16px;
                gap: 8px;
            }
            .legend-symbol {
                width: 40px;
                height: 40px;
                font-size: 30px;
            }
        }
        
        /* Slot Machine Card */
        .slot-machine {
            background: linear-gradient(135deg, rgba(255, 182, 193, 0.6) 0%, rgba(255, 160, 180, 0.5) 100%);
            border-radius: 32px;
            padding: clamp(20px, 3vh, 50px) clamp(15px, 2.5vw, 40px);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            animation: fadeInUp 0.8s ease-out;
            width: 100%;
            max-height: 98vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Less rounded corners on large screens for better edge-to-edge look */
        @media (min-width: 1200px) {
            .slot-machine {
                border-radius: 20px;
            }
            
            .reels-container {
                border-radius: 20px;
            }
            
            body {
                padding: 8px;
            }
        }
        
        /* Even less rounded on very large screens/TVs */
        @media (min-width: 1920px) {
            .slot-machine {
                border-radius: 12px;
            }
            
            .reels-container {
                border-radius: 12px;
            }
            
            body {
                padding: 12px;
            }
        }
        
        /* Maximum screen usage for ultra-wide or huge displays */
        @media (min-width: 2560px) {
            .slot-machine {
                border-radius: 8px;
            }
            
            .reels-container {
                border-radius: 8px;
            }
            
            body {
                padding: 15px;
            }
        }

        /* Layout Design Overlays */
        .prize-legend::before,
        .slot-machine::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            pointer-events: none;
            z-index: 10;
            border-radius: inherit;
        }
        
        .prize-legend.has-layout::before {
            background-image: var(--legend-layout);
        }
        
        .slot-machine.has-layout::before {
            background-image: var(--machine-layout);
        }
        
        
        .slot-machine::before {
            top: -10px;
            left: -10px;
            border-right: none;
            border-bottom: none;
        }
        
        .slot-machine::after {
            bottom: -10px;
            right: -10px;
            border-left: none;
            border-top: none;
        }
        
        /* Reels Container */
        .reels-container {
            display: flex;
            gap: clamp(30px, 5vw, 80px);
            margin-bottom: clamp(20px, 3vh, 40px);
            padding: clamp(24px, 3vw, 50px);
            background: linear-gradient(135deg, rgba(156, 89, 101, 0.9) 0%, rgba(139, 82, 94, 0.8) 100%);
            border-radius: 24px;
            border: 2px solid rgba(255, 255, 255, 0.05);
            box-shadow: 
                inset 0 2px 8px rgba(0, 0, 0, 0.3),
                0 4px 20px rgba(0, 0, 0, 0.2);
        }
        
        .reel {
            flex: 1;
            height: clamp(250px, 35vh, 500px);
            background: var(--reel-bg-color);
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                inset 0 2px 10px rgba(0, 0, 0, 0.5),
                0 2px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        /* Highlight reel when it's spinning */
        .reel.active-spin {
            border-color: rgba(244, 224, 77, 0.6);
            box-shadow: 
                inset 0 2px 10px rgba(0, 0, 0, 0.5),
                0 2px 10px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(244, 224, 77, 0.4);
            transform: scale(1.02);
        }
        
        /* Reveal flash when reel stops */
        .reel.reveal-flash {
            animation: revealFlash 0.5s ease-out;
        }
        
        @keyframes revealFlash {
            0% {
                box-shadow: 
                    inset 0 2px 10px rgba(0, 0, 0, 0.5),
                    0 2px 10px rgba(0, 0, 0, 0.3),
                    0 0 40px rgba(244, 224, 77, 0.9),
                    0 0 60px rgba(244, 224, 77, 0.6);
            }
            100% {
                box-shadow: 
                    inset 0 2px 10px rgba(0, 0, 0, 0.5),
                    0 2px 10px rgba(0, 0, 0, 0.3);
            }
        }
        
        /* Highlight line in the middle of reels */
        .reel::after {
            content: '';
            position: absolute;
            top: 50%;
            left: -10%;
            right: -10%;
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(var(--primary-rgb), 0.9), transparent);
            transform: translateY(-50%);
            pointer-events: none;
            z-index: 10;
            box-shadow: 0 0 20px rgba(var(--primary-rgb), 0.8),
                        0 0 40px rgba(var(--primary-rgb), 0.4);
            animation: goldenLinePulse 2s ease-in-out infinite;
        }
        
        /* Faster pulse when reel is actively spinning */
        .reel.active-spin::after {
            animation: goldenLinePulseFast 0.5s ease-in-out infinite;
        }
        
        @keyframes goldenLinePulse {
            0%, 100% {
                opacity: 0.8;
                box-shadow: 0 0 20px rgba(var(--primary-rgb), 0.9),
                            0 0 40px rgba(var(--primary-rgb), 0.4);
                height: 3px;
            }
            50% {
                opacity: 1;
                box-shadow: 0 0 30px rgba(var(--primary-rgb), 1),
                            0 0 60px rgba(var(--primary-rgb), 0.6),
                            0 0 80px rgba(var(--primary-rgb), 0.3);
                height: 4px;
            }
        }
        
        @keyframes goldenLinePulseFast {
            0%, 100% {
                opacity: 0.9;
                box-shadow: 0 0 25px rgba(var(--primary-rgb), 1),
                            0 0 50px rgba(var(--primary-rgb), 0.5);
                height: 3px;
            }
            50% {
                opacity: 1;
                box-shadow: 0 0 35px rgba(var(--primary-rgb), 1),
                            0 0 70px rgba(var(--primary-rgb), 0.7),
                            0 0 100px rgba(var(--primary-rgb), 0.4);
                height: 5px;
            }
        }
        
        .reel-strip {
            position: relative;
            transition: filter 0.3s ease-in-out;
        }
        
        .reel-strip.spinning {
            /* Smooth spinning animation - no blur */
        }
        
        .reel-strip.spinning .reel-symbol {
            /* Smooth scrolling effect */
        }
        
        .reel-symbol {
            height: clamp(83px, 11.67vh, 167px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(50px, 9vh, 100px);
            position: relative;
            transition: transform 0.3s ease;
        }
        
        .reel-symbol img {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3));
            transition: all 0.3s ease;
        }
        
        /* Winning symbol highlight */
        .reel-symbol.winning {
            animation: winningPulse 1s ease-in-out;
            z-index: 10;
        }
        
        .reel-symbol.winning img {
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)) 
                    drop-shadow(0 0 30px rgba(255, 215, 0, 0.6))
                    drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3));
        }
        
        @keyframes winningPulse {
            0% { transform: scale(1); }
            25% { transform: scale(1.3); }
            50% { transform: scale(1.15); }
            75% { transform: scale(1.25); }
            100% { transform: scale(1); }
        }
        
        /* Info Display */
        .info-display {
            text-align: center;
            margin-bottom: clamp(18px, 2.5vh, 36px);
            padding: clamp(14px, 2vh, 28px);
            background: rgba(255, 182, 193, 0.3);
            border-radius: 16px;
            border: 1px solid rgba(255, 192, 203, 0.4);
        }
        
        .info-display p {
            color: #f4e04d;
            font-size: clamp(18px, 3vh, 42px);
            font-weight: 600;
            letter-spacing: 0.5px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        /* Spin Button */
        .spin-button {
            width: 100%;
            padding: clamp(18px, 3vh, 45px);
            border-radius: 20px;
            background: linear-gradient(135deg, #f4e04d 0%, #e8d636 100%);
            border: none;
            cursor: pointer;
            font-size: clamp(24px, 4.5vh, 56px);
            font-weight: 900;
            color: #000000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 10px 30px rgba(244, 224, 77, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
            /* Better mobile touch */
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        
        .spin-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .spin-button:hover:not(.disabled) {
            transform: translateY(-3px);
            box-shadow: 
                0 15px 40px rgba(244, 224, 77, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        .spin-button:hover:not(.disabled)::before {
            left: 100%;
        }
        
        .spin-button:active:not(.disabled) {
            transform: translateY(-1px);
            box-shadow: 
                0 5px 20px rgba(244, 224, 77, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        .spin-button.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: linear-gradient(135deg, #888 0%, #aaa 100%);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2) !important;
        }
        
        .spin-button .spinner-icon {
            display: inline-block;
            margin-left: 8px;
            animation: rotate 1s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Win Popup */
        .win-popup {
            position: relative;
            width: 100%;
            margin: 0 auto clamp(12px, 1.5vh, 24px) auto;
            transform: scale(1);
            background: rgba(255, 182, 193, 0.2);
            padding: clamp(14px, 2.2vh, 32px) clamp(16px, 2vw, 40px);
            border-radius: 16px;
            text-align: left;
            z-index: 1000;
            opacity: 1;
            min-height: clamp(80px, 12vh, 150px);
            max-height: clamp(120px, 18vh, 200px);
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            gap: clamp(16px, 2.5vw, 40px);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 2px solid rgba(255, 192, 203, 0.3);
            overflow: hidden;
        }
        
        .win-popup.show {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border: 4px solid #f4e04d;
        }
        
        .win-popup > * {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .win-popup.show > * {
            opacity: 1;
        }
        
        .win-popup .emoji {
            font-size: clamp(50px, 8vh, 120px);
            margin-bottom: 0;
            animation: bounce 0.6s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            width: clamp(60px, 10vh, 130px);
            height: clamp(60px, 10vh, 130px);
            padding-right: clamp(12px, 2vw, 24px);
            border-right: 2px solid rgba(255, 192, 203, 0.3);
        }
        
        .win-popup .emoji img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3));
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        /* Text content container */
        .win-popup-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: clamp(4px, 0.8vh, 10px);
            padding-right: clamp(12px, 2vw, 24px);
            border-right: 2px solid rgba(255, 192, 203, 0.3);
        }
        
        .win-popup h1 {
            font-size: clamp(28px, 5vh, 64px);
            font-weight: 900;
            background: linear-gradient(135deg, #ff9999 0%, #ff8888 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0;
            letter-spacing: 1px;
            line-height: 1;
            text-align: left;
        }
        
        .win-popup p {
            font-size: clamp(14px, 2.8vh, 32px);
            color: #636e72;
            margin-bottom: 0;
            font-weight: 600;
            line-height: 1.2;
            text-align: left;
        }
        
        .win-popup .prize {
            font-size: clamp(20px, 4vh, 52px);
            font-weight: 800;
            color: #f4e04d;
            padding: clamp(12px, 2vh, 24px) clamp(20px, 3.5vw, 48px);
            background: linear-gradient(135deg, rgba(244, 224, 77, 0.15) 0%, rgba(244, 224, 77, 0.08) 100%);
            border-radius: 12px;
            border: 2px solid rgba(244, 224, 77, 0.3);
            margin-top: 0;
            text-shadow: 0 2px 10px rgba(244, 224, 77, 0.3);
            line-height: 1.2;
            text-align: center;
            flex-shrink: 0;
            white-space: nowrap;
        }
        
        /* Emoji Rain */
        .emoji-rain {
            position: fixed;
            top: -10%;
            z-index: 999;
            pointer-events: none;
            animation: emojiRainFall 3s linear forwards;
        }
        
        .emoji-rain img {
            width: 70px;
            height: 70px;
            object-fit: contain;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3));
        }
        
        @keyframes emojiRainFall {
            0% {
                top: -10%;
                opacity: 1;
                transform: translateX(0) rotate(0deg) scale(1);
            }
            50% {
                opacity: 1;
            }
            100% {
                top: 110%;
                opacity: 0;
                transform: translateX(var(--drift)) rotate(360deg) scale(0.7);
            }
        }
        
        /* Loading */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.3s ease-out;
        }
        
        .loading.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(var(--primary-rgb), 0.2);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 20px;
        }
        
        .loading-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 18px;
            font-weight: 600;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Responsive */
        @media (max-width: 640px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 0;
            }
            
            .header {
                margin-bottom: 16px;
            }
            
            .header h1 {
                font-size: 36px;
                line-height: 1.2;
            }
            
            .animated-logo {
                font-size: 38px !important;
            }
            
            .lucky-spin-text {
                font-size: 28px;
            }
            
            .header p {
                font-size: 14px;
            }
            
            /* Prize Legend Mobile */
            .prize-legend {
                padding: 12px;
                gap: 12px;
                margin: 16px 0;
            }
            
            .legend-item {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .legend-arrow {
                font-size: 14px;
            }
            
            .legend-prize {
                font-size: 13px;
            }
            
            .slot-machine {
                padding: 20px 12px;
                border-radius: 20px;
            }
            
            .reels-container {
                gap: 8px;
                padding: 12px;
            }
            
            .reel {
                height: 180px;
                border-radius: 12px;
            }
            
            .reel-symbol {
                height: 60px;
                font-size: 40px;
            }
            
            .reel-symbol img {
                max-width: 90%;
                max-height: 90%;
            }
            
            .info-display {
                padding: 14px;
                margin-bottom: 20px;
            }
            
            .info-display p {
                font-size: 15px;
            }
            
            .spin-button {
                padding: 20px;
                font-size: 24px;
                border-radius: 12px;
                /* Larger touch target for mobile */
                min-height: 60px;
            }
            
            .win-popup {
                padding: 12px 14px;
                max-width: 95vw;
                border-radius: 12px;
                min-height: 80px;
                max-height: 110px;
                gap: 12px;
            }
            
            .win-popup .emoji {
                width: 60px;
                height: 60px;
                font-size: 50px;
            }
            
            .win-popup h1 {
                font-size: 22px;
            }
            
            .win-popup p {
                font-size: 12px;
            }
            
            .win-popup .prize {
                font-size: 16px;
                padding: 10px 14px;
            }
            
            .fullscreen-btn {
                width: 50px;
                height: 50px;
                top: 10px;
                right: 10px;
                font-size: 24px;
                /* Easier to tap */
                border: 2px solid rgba(255, 255, 255, 0.3);
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }
            
            .header {
                margin-bottom: 12px;
            }
            
            .header h1 {
                font-size: 32px;
                line-height: 1.3;
            }
            
            .animated-logo {
                font-size: 32px !important;
                margin-bottom: 4px;
            }
            
            .lucky-spin-text {
                font-size: 24px;
            }
            
            .header p {
                font-size: 13px;
            }
            
            /* Compact prize legend for small screens */
            .prize-legend {
                padding: 10px;
                gap: 8px;
                margin: 12px 0;
            }
            
            .legend-item {
                padding: 6px 10px;
                flex-direction: column;
                gap: 4px;
                text-align: center;
            }
            
            .legend-symbols {
                gap: 2px;
            }
            
            .legend-symbol {
                width: 28px;
                height: 28px;
                font-size: 20px;
            }
            
            .legend-symbol img {
                width: 24px;
                height: 24px;
            }
            
            .legend-arrow {
                font-size: 12px;
                transform: rotate(90deg);
            }
            
            .legend-prize {
                font-size: 11px;
            }
            
            .slot-machine {
                padding: 16px 10px;
            }
            
            .reels-container {
                gap: 6px;
                padding: 10px;
            }
            
            .reel {
                height: 150px;
            }
            
            .reel-symbol {
                height: 50px;
                font-size: 32px;
            }
            
            .info-display {
                padding: 10px;
            }
            
            .info-display p {
                font-size: 13px;
            }
            
            .spin-button {
                padding: 18px;
                font-size: 20px;
                min-height: 56px;
            }
            
            .fullscreen-btn {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
        }
        
        /* Landscape mobile optimization */
        @media (max-height: 500px) and (orientation: landscape) {
            body {
                padding: 5px;
            }
            
            .header {
                margin-bottom: 8px;
            }
            
            .header h1 {
                font-size: 22px;
                margin-bottom: 4px;
                line-height: 1.2;
            }
            
            .animated-logo {
                font-size: 24px !important;
            }
            
            .lucky-spin-text {
                font-size: 18px;
            }
            
            .header p {
                font-size: 11px;
            }
            
            /* Hide or minimize prize legend in landscape */
            .prize-legend {
                padding: 6px;
                gap: 6px;
                margin: 8px 0;
            }
            
            .legend-item {
                padding: 4px 8px;
                font-size: 10px;
            }
            
            .legend-symbol {
                width: 24px;
                height: 24px;
                font-size: 18px;
            }
            
            .slot-machine {
                padding: 12px 15px;
            }
            
            .reels-container {
                margin-bottom: 15px;
                padding: 10px;
            }
            
            .reel {
                height: 140px;
            }
            
            .info-display {
                margin-bottom: 12px;
                padding: 8px;
            }
            
            .info-display p {
                font-size: 12px;
            }
            
            .spin-button {
                padding: 12px;
                font-size: 18px;
                min-height: 48px;
            }
            
            .fullscreen-btn {
                top: 8px;
                right: 8px;
                width: 40px;
                height: 40px;
            }
        }
        
        /* Fullscreen Button */
        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s;
            z-index: 10001;
        }
        
        .fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: scale(1.1);
        }
        
        .fullscreen-btn:active {
            transform: scale(0.95);
        }
        
        /* When in fullscreen mode, hide header and center everything */
        body:fullscreen .header,
        body:-webkit-full-screen .header,
        body:-moz-full-screen .header,
        body:-ms-fullscreen .header {
            display: none;
        }
        
        body:fullscreen,
        body:-webkit-full-screen,
        body:-moz-full-screen,
        body:-ms-fullscreen {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        body:fullscreen .container,
        body:-webkit-full-screen .container,
        body:-moz-full-screen .container,
        body:-ms-fullscreen .container {
            max-width: 1000px;
            width: 100%;
        }
        
        body:fullscreen .slot-machine,
        body:-webkit-full-screen .slot-machine,
        body:-moz-full-screen .slot-machine,
        body:-ms-fullscreen .slot-machine {
            padding: 50px 40px;
        }
        
        body:fullscreen .reels-container,
        body:-webkit-full-screen .reels-container,
        body:-moz-full-screen .reels-container,
        body:-ms-fullscreen .reels-container {
            padding: 32px;
            gap: 32px;
        }
        
        body:fullscreen .reel,
        body:-webkit-full-screen .reel,
        body:-moz-full-screen .reel,
        body:-ms-fullscreen .reel {
            height: 300px;
        }
        
        body:fullscreen .reel-symbol,
        body:-webkit-full-screen .reel-symbol,
        body:-moz-full-screen .reel-symbol,
        body:-ms-fullscreen .reel-symbol {
            height: 100px;
            font-size: 80px;
        }
        
        body:fullscreen .info-display,
        body:-webkit-full-screen .info-display,
        body:-moz-full-screen .info-display,
        body:-ms-fullscreen .info-display {
            padding: 20px;
            margin-bottom: 40px;
        }
        
        body:fullscreen .info-display p,
        body:-webkit-full-screen .info-display p,
        body:-moz-full-screen .info-display p,
        body:-ms-fullscreen .info-display p {
            font-size: 22px;
        }
        
        body:fullscreen .spin-button,
        body:-webkit-full-screen .spin-button,
        body:-moz-full-screen .spin-button,
        body:-ms-fullscreen .spin-button {
            padding: 24px;
            font-size: 32px;
        }

        /* ============================================
           MOBILE-ONLY ENHANCEMENTS (PHONES)
           Desktop styling remains unchanged!
           ============================================ */
        
        /* Enhanced mobile layout for better fit */
        @media (max-width: 768px) {
            /* Ensure no horizontal scroll */
            html {
                overflow-x: hidden;
            }
            
            body {
                overflow-x: hidden;
                width: 100vw;
            }
            
            /* Make container use full mobile screen */
            .container {
                max-width: 100vw;
                width: 100%;
                max-height: 100vh;
            }
            
            /* Better touch targets */
            button, .btn {
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }
            
            /* Prevent text selection on mobile */
            .slot-machine, .reel, .spin-button {
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
        }
        
        /* Mobile fullscreen mode (iOS compatible) */
        @media (max-width: 768px) {
            body.mobile-fullscreen {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                overflow: hidden;
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            }
            
            body.mobile-fullscreen .header {
                display: none !important;
            }
            
            body.mobile-fullscreen .prize-legend {
                display: none !important;
            }
            
            body.mobile-fullscreen .container {
                max-height: 100vh;
                height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 10px;
            }
            
            body.mobile-fullscreen .slot-machine {
                max-height: 100%;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }
            
            body.mobile-fullscreen .reels-container {
                flex: 1;
                display: flex;
                align-items: center;
                max-height: 60vh;
            }
            
            body.mobile-fullscreen .reel {
                height: auto;
                max-height: 100%;
            }
            
            body.mobile-fullscreen .info-display {
                margin-bottom: 15px;
            }
            
            body.mobile-fullscreen .spin-button {
                font-size: 28px;
                padding: 25px;
                margin-top: 15px;
            }
            
            /* Fullscreen button larger in mobile fullscreen */
            body.mobile-fullscreen .fullscreen-btn {
                width: 60px;
                height: 60px;
                font-size: 30px;
                z-index: 10001;
            }
        }
        
        /* Extra small phones (iPhone SE, etc) */
        @media (max-width: 375px) {
            .slot-machine {
                padding: 15px 10px !important;
            }
            
            .reels-container {
                gap: 6px !important;
                padding: 10px !important;
            }
            
            .reel {
                height: 150px !important;
            }
            
            .reel-symbol {
                height: 50px !important;
                font-size: 35px !important;
            }
            
            .spin-button {
                font-size: 20px !important;
                padding: 18px !important;
            }
        }
        
        /* Landscape mode on mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            .header {
                margin-bottom: 10px;
            }
            
            .slot-machine {
                padding: 15px 10px;
            }
            
            .reels-container {
                max-height: 50vh;
            }
            
            .reel {
                height: auto;
                max-height: 40vh;
            }
            
            .info-display {
                padding: 10px;
                margin-bottom: 10px;
            }
            
            .spin-button {
                padding: 15px;
                font-size: 20px;
            }
        }

        /* Mobile ‚Äî no scroll, fullscreen button hidden, popup fixed */
        @media (max-width: 768px) {

            html, body {
                overflow: hidden;
                height: 100%;
            }

            /* Hide fullscreen button ‚Äî not needed on mobile */
            .fullscreen-btn {
                display: none !important;
            }

            /* Fix win popup ‚Äî prevent text/prize box being cut off */
            .win-popup {
                flex-direction: row;
                flex-wrap: nowrap;
                align-items: center;
                max-height: none;
                min-height: unset;
                padding: 10px 12px;
                gap: 8px;
            }

            .win-popup .emoji {
                font-size: 30px;
                width: 40px;
                height: 40px;
                padding-right: 8px;
                flex-shrink: 0;
            }

            .win-popup-content {
                flex: 1;
                min-width: 0;
                padding-right: 6px;
                gap: 2px;
                overflow: hidden;
            }

            .win-popup h1 {
                font-size: 16px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .win-popup p {
                font-size: 11px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .win-popup .prize {
                font-size: 11px;
                padding: 6px 8px;
                white-space: nowrap;
                flex-shrink: 0;
                max-width: 38%;
                overflow: hidden;
                text-overflow: ellipsis;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div class="loading-text">Loading your lucky spin...</div>
    </div>
    
    <button class="fullscreen-btn" id="fullscreen-btn" title="Toggle Fullscreen">‚õ∂</button>
    
    <div class="container" id="main-container">
        <div class="header">
            <h1>
                <span class="animated-logo">CHICKILICIOUS</span>
                <span class="lucky-spin-text">
                    <span class="emoji">üé∞</span>
                    <span class="text"> LUCKY SPIN</span>
                </span>
            </h1>
            <p>Try your luck and win amazing prizes!</p>
        </div>
        
        <!-- Prize Legend -->
        <div class="prize-legend" id="prize-legend">
            <div class="layout-image-container" id="legend-layout-container">
                <img id="legend-layout-img" src="" alt="">
            </div>
            <!-- Will be populated by JavaScript with actual symbols -->
        </div>
        
        <div class="slot-machine">
            <div class="layout-image-container" id="machine-layout-container">
                <img id="machine-layout-img" src="" alt="">
            </div>

            <div class="win-popup" id="popup">
                <div class="emoji">üéâ</div>
                <div class="win-popup-content">
                    <h1 id="popup-title">CONGRATULATIONS!</h1>
                    <p id="popup-message">You won a prize!</p>
                </div>
                <div class="prize" id="popup-prize">üéÅ Mystery Prize</div>
            </div>

            <div class="reels-container">
                <div class="reel"><div class="reel-strip" id="reel1"></div></div>
                <div class="reel"><div class="reel-strip" id="reel2"></div></div>
                <div class="reel"><div class="reel-strip" id="reel3"></div></div>
            </div>
            
            <div class="info-display">
                <p id="info-text">Press SPIN to play!</p>
            </div>
            
            <button class="spin-button" id="spin-btn">
                <span id="btn-text">SPIN NOW</span>
            </button>
        </div>
    </div>

    <script>
        // Dynamic server URL detection
        const SERVER_URLS = [
            'http://192.168.50.146:3000', // LAN IP (try this first for mobile)
            'http://localhost:3000', // Localhost
            window.location.origin // Current origin (if same server)
        ];
        
        async function fetchFromServer(endpoint) {
            for (const baseUrl of SERVER_URLS) {
                try {
                    console.log(`Trying to fetch from: ${baseUrl}${endpoint}`);
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout
                    
                    const res = await Promise.race([
                        fetch(`${baseUrl}${endpoint}`, { 
                            method: 'GET',
                            headers: { 'Accept': 'application/json' },
                            signal: controller.signal
                        }),
                        new Promise((_, reject) => 
                            setTimeout(() => reject(new Error('Fetch timeout')), 5000)
                        )
                    ]);
                    
                    clearTimeout(timeoutId);
                    
                    if (res && res.ok) {
                        try {
                            const text = await res.text();
                            if (!text) {
                                console.log(`‚úó Empty response from ${baseUrl}`);
                                continue;
                            }
                            const data = JSON.parse(text);
                            console.log(`‚úì Success from ${baseUrl}`);
                            return data;
                        } catch (parseError) {
                            console.log(`‚úó JSON parse error from ${baseUrl}: ${parseError.message}`);
                            continue;
                        }
                    }
                } catch (e) {
                    if (e.name === 'AbortError') {
                        console.log(`‚úó Timeout from ${baseUrl}`);
                    } else {
                        console.log(`‚úó Failed from ${baseUrl}: ${e.message}`);
                    }
                }
            }
            console.log('All server URLs failed, using defaults');
            return null;
        }
        
        let symbols = [];
        let duration = 2;
        let spinning = false;

        // ONE shared AudioContext reused for every sound.
        // Must be created inside a direct user gesture (the click handler).
        // Reusing it in setTimeouts is fine - that's what makes win/lose work.
        let _audioCtx = null;
        function getAudioCtx() {
            const AC = window.AudioContext || window.webkitAudioContext;
            if (!_audioCtx) _audioCtx = new AC();
            if (_audioCtx.state === 'suspended') _audioCtx.resume();
            return _audioCtx;
        }
        let cachedOdds = { THREE_MATCH: 10, TWO_MATCH: 25, NO_MATCH: 65 }; // Cache odds to avoid delay on spin
        
        // Sound effects
        const sounds = {
            spin: null,
            win: null,
            jackpot: null,
            lose: null
        };
        
        // Initialize sound effects
        async function initSounds() {
            // Electronic Beeping sound - synchronized with spin duration
            sounds.spin = {
                play: function(spinDuration = 2.5) {
                    try {
                        const audioCtx = getAudioCtx();
                        const totalDuration = spinDuration + 1.2;
                        const beepCount = Math.floor(spinDuration * 12);
                        const frequencies = [440, 493, 523, 587, 659];
                        
                        for (let i = 0; i < beepCount; i++) {
                            const oscillator = audioCtx.createOscillator();
                            const gainNode = audioCtx.createGain();
                            
                            oscillator.connect(gainNode);
                            gainNode.connect(audioCtx.destination);
                            
                            oscillator.frequency.value = frequencies[i % frequencies.length];
                            oscillator.type = 'sine';
                            
                            const progress = i / beepCount;
                            const delay = Math.pow(progress, 2) * totalDuration;
                            
                            const startTime = audioCtx.currentTime + delay;
                            gainNode.gain.setValueAtTime(0.18, startTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.08);
                            
                            oscillator.start(startTime);
                            oscillator.stop(startTime + 0.08);
                        }
                    } catch(e) { console.log('Sound error:', e); }
                }
            };
            
            /* ALTERNATIVE SPIN SOUND OPTIONS - Uncomment to use
            
            // OPTION 2: Smooth whooshing sound (like a wheel spinning)
            sounds.spin = {
                play: function(spinDuration = 2.5) {
                    try {
                        const audioCtx = getAudioCtx();
                        const totalDuration = spinDuration + 1.2;
                        const oscillator = audioCtx.createOscillator();
                        const gainNode = audioCtx.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioCtx.destination);
                        
                        // Start at high frequency, slow down to low
                        oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(150, audioCtx.currentTime + totalDuration);
                        oscillator.type = 'sawtooth';
                        
                        gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.2, audioCtx.currentTime + 0.1);
                        gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime + totalDuration - 0.3);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + totalDuration);
                        
                        oscillator.start(audioCtx.currentTime);
                        oscillator.stop(audioCtx.currentTime + totalDuration);
                    } catch(e) { console.log('Sound error:', e); }
                }
            };
            
            // OPTION 3: Mechanical clicking (like a ratchet)
            sounds.spin = {
                play: function(spinDuration = 2.5) {
                    try {
                        const audioCtx = getAudioCtx();
                        const totalDuration = spinDuration + 1.2;
                        const clickCount = Math.floor(spinDuration * 20); // Adjust clicks based on duration
                        
                        for (let i = 0; i < clickCount; i++) {
                            const oscillator = audioCtx.createOscillator();
                            const gainNode = audioCtx.createGain();
                            const filterNode = audioCtx.createBiquadFilter();
                            
                            oscillator.connect(filterNode);
                            filterNode.connect(gainNode);
                            gainNode.connect(audioCtx.destination);
                            
                            filterNode.type = 'bandpass';
                            filterNode.frequency.value = 3000;
                            
                            oscillator.type = 'square';
                            oscillator.frequency.value = 100;
                            
                            // Exponentially increasing delay between clicks
                            const progress = i / clickCount;
                            const delay = Math.pow(progress, 1.5) * totalDuration;
                            
                            const startTime = audioCtx.currentTime + delay;
                            gainNode.gain.setValueAtTime(0.3, startTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.03);
                            
                            oscillator.start(startTime);
                            oscillator.stop(startTime + 0.03);
                        }
                    } catch(e) { console.log('Sound error:', e); }
                }
            };
            
            // OPTION 4: Electronic beeping (arcade style)
            sounds.spin = {
                play: function(spinDuration = 2.5) {
                    try {
                        const audioCtx = getAudioCtx();
                        const totalDuration = spinDuration + 1.2;
                        const beepCount = Math.floor(spinDuration * 12);
                        const frequencies = [440, 493, 523, 587, 659]; // Musical notes
                        
                        for (let i = 0; i < beepCount; i++) {
                            const oscillator = audioCtx.createOscillator();
                            const gainNode = audioCtx.createGain();
                            
                            oscillator.connect(gainNode);
                            gainNode.connect(audioCtx.destination);
                            
                            // Use cycling frequencies for variety
                            oscillator.frequency.value = frequencies[i % frequencies.length];
                            oscillator.type = 'sine';
                            
                            const progress = i / beepCount;
                            const delay = Math.pow(progress, 2) * totalDuration;
                            
                            const startTime = audioCtx.currentTime + delay;
                            gainNode.gain.setValueAtTime(0.18, startTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.08);
                            
                            oscillator.start(startTime);
                            oscillator.stop(startTime + 0.08);
                        }
                    } catch(e) { console.log('Sound error:', e); }
                }
            };
            
            // OPTION 5: Drum roll (building tension)
            sounds.spin = {
                play: function(spinDuration = 2.5) {
                    try {
                        const audioCtx = getAudioCtx();
                        const totalDuration = spinDuration + 1.2;
                        const hitCount = Math.floor(spinDuration * 25);
                        
                        for (let i = 0; i < hitCount; i++) {
                            const oscillator = audioCtx.createOscillator();
                            const gainNode = audioCtx.createGain();
                            const filterNode = audioCtx.createBiquadFilter();
                            
                            oscillator.connect(filterNode);
                            filterNode.connect(gainNode);
                            gainNode.connect(audioCtx.destination);
                            
                            filterNode.type = 'lowpass';
                            filterNode.frequency.value = 200 + (Math.random() * 100);
                            
                            oscillator.type = 'sawtooth';
                            oscillator.frequency.value = 80 + (Math.random() * 20);
                            
                            const progress = i / hitCount;
                            // Accelerating drum roll
                            const delay = Math.pow(progress, 0.8) * totalDuration;
                            
                            const startTime = audioCtx.currentTime + delay;
                            gainNode.gain.setValueAtTime(0.25, startTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.04);
                            
                            oscillator.start(startTime);
                            oscillator.stop(startTime + 0.04);
                        }
                    } catch(e) { console.log('Sound error:', e); }
                }
            };
            
            */ // End of alternative sound options
            
            // Win sound - pleasant ascending tones
            sounds.win = {
                play: function() {
                    try {
                        const audioCtx = getAudioCtx();
                        [523, 659, 784].forEach((freq, i) => {
                            const oscillator = audioCtx.createOscillator();
                            const gainNode = audioCtx.createGain();
                            
                            oscillator.connect(gainNode);
                            gainNode.connect(audioCtx.destination);
                            
                            oscillator.frequency.value = freq;
                            oscillator.type = 'sine';
                            
                            const startTime = audioCtx.currentTime + (i * 0.1);
                            gainNode.gain.setValueAtTime(0.2, startTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
                            
                            oscillator.start(startTime);
                            oscillator.stop(startTime + 0.3);
                        });
                    } catch(e) { console.log('Sound error:', e); }
                }
            };
            
            // Jackpot sound - celebratory fanfare
            sounds.jackpot = {
                play: function() {
                    try {
                        const audioCtx = getAudioCtx();
                        const frequencies = [523, 659, 784, 1047];
                        frequencies.forEach((freq, i) => {
                            const oscillator = audioCtx.createOscillator();
                            const gainNode = audioCtx.createGain();
                            
                            oscillator.connect(gainNode);
                            gainNode.connect(audioCtx.destination);
                            
                            oscillator.frequency.value = freq;
                            oscillator.type = 'triangle';
                            
                            const startTime = audioCtx.currentTime + (i * 0.15);
                            gainNode.gain.setValueAtTime(0.25, startTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.4);
                            
                            oscillator.start(startTime);
                            oscillator.stop(startTime + 0.4);
                        });
                    } catch(e) { console.log('Sound error:', e); }
                }
            };
            
            // Lose sound - descending tone
            sounds.lose = {
                play: function() {
                    try {
                        const audioCtx = getAudioCtx();
                        const oscillator = audioCtx.createOscillator();
                        const gainNode = audioCtx.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioCtx.destination);
                        
                        oscillator.frequency.setValueAtTime(400, audioCtx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.5);
                        oscillator.type = 'sawtooth';
                        gainNode.gain.setValueAtTime(0.15, audioCtx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                        
                        oscillator.start(audioCtx.currentTime);
                        oscillator.stop(audioCtx.currentTime + 0.5);
                    } catch(e) { console.log('Sound error:', e); }
                }
            };
        }
        
        // Prize configurations
        const prizes = {
            THREE_MATCH: {
                title: 'JACKPOT!',
                message: 'All symbols matched! üéä',
                prize: 'üèÜ GRAND PRIZE'
            },
            TWO_MATCH: {
                title: 'YOU WIN!',
                message: 'Two symbols matched!',
                prize: 'üéÅ SPECIAL PRIZE'
            },
            NO_MATCH: {
                title: 'ALMOST!',
                message: 'Better luck next time!',
                prize: 'üé´ CONSOLATION PRIZE'
            }
        };
        
        // Load settings
        async function loadSettings() {
            // Load symbols from SERVER ONLY
            try {
                const settingsPromise = fetchFromServer('/api/load/symbols');
                const timeoutPromise = new Promise(resolve => setTimeout(() => resolve(null), 800));
                const serverData = await Promise.race([settingsPromise, timeoutPromise]);
                
                if (serverData && serverData.length > 0) {
                    symbols = serverData.map(s => s.image || s.emoji);
                    console.log('Loaded symbols from server:', symbols.length);
                } else {
                    // Use default symbols if server fails
                    symbols = ['üçí', '7Ô∏è‚É£', 'üçã', 'üçä', '‚≠ê', 'üíé', 'üîî', 'üçÄ'];
                }
            } catch (e) {
                console.log('Failed to load symbols, using defaults:', e.message);
                symbols = ['üçí', '7Ô∏è‚É£', 'üçã', 'üçä', '‚≠ê', 'üíé', 'üîî', 'üçÄ'];
            }
            
            // PRE-LOAD probabilities from SERVER ONLY
            try {
                const oddsPromise = fetchFromServer('/api/load/probabilities');
                const oddsTimeout = new Promise(resolve => setTimeout(() => resolve(null), 800));
                const serverOdds = await Promise.race([oddsPromise, oddsTimeout]);
                
                if (serverOdds) {
                    cachedOdds = serverOdds;
                    console.log('Loaded odds from server:', cachedOdds);
                }
            } catch (e) {
                console.log('Failed to load odds, using defaults:', e);
            }
            
            // PRE-LOAD spin speed from SERVER ONLY
            try {
                const speedPromise = fetchFromServer('/api/load/spinSpeed');
                const speedTimeout = new Promise(resolve => setTimeout(() => resolve(null), 800));
                const serverSpeed = await Promise.race([speedPromise, speedTimeout]);
                
                if (serverSpeed) {
                    duration = parseFloat(serverSpeed);
                    console.log('Loaded speed from server:', duration);
                }
            } catch (e) {
                console.log('Failed to load speed, using default:', e);
            }
            
            // Load background
            await loadBackground();
            
            // Load color theme
            await loadColorTheme();
        }
        
        // Load and apply background
        async function loadBackground() {
            try {
                // Load background from SERVER ONLY
                const bgPromise = fetchFromServer('/api/load/background');
                const timeoutPromise = new Promise(resolve => setTimeout(() => resolve(null), 800));
                const bgData = await Promise.race([bgPromise, timeoutPromise]);
                
                if (bgData) {
                    const body = document.body;
                    
                    if (bgData.type === 'color') {
                        body.style.background = bgData.value;
                    } else if (bgData.type === 'gradient') {
                        body.style.background = bgData.value;
                    } else if (bgData.type === 'image') {
                        body.style.backgroundImage = `url(${bgData.value})`;
                        body.style.backgroundSize = 'cover';
                        body.style.backgroundPosition = 'center';
                        body.style.backgroundAttachment = 'fixed';
                    }
                }
            } catch (e) {
                console.log('Failed to load background:', e.message);
            }
        }
        
        // Load and apply color theme
        async function loadColorTheme() {
            try {
                // Load color theme from SERVER ONLY
                const themePromise = fetchFromServer('/api/load/colorTheme');
                const timeoutPromise = new Promise(resolve => setTimeout(() => resolve(null), 800));
                const themeData = await Promise.race([themePromise, timeoutPromise]);
                
                if (themeData) {
                    const root = document.documentElement;
                    
                    // Set CSS variables for accent color (used in glows, buttons, etc.)
                    if (themeData.spinBtnBg) {
                        root.style.setProperty('--primary-color', themeData.spinBtnBg);
                        root.style.setProperty('--primary-light', themeData.spinBtnBg);
                        
                        // Extract RGB values from hex color for rgba colors
                        const hex = themeData.spinBtnBg.replace('#', '');
                        const r = parseInt(hex.substring(0, 2), 16);
                        const g = parseInt(hex.substring(2, 4), 16);
                        const b = parseInt(hex.substring(4, 6), 16);
                        root.style.setProperty('--primary-rgb', `${r}, ${g}, ${b}`);
                    }
                    
                    // Set reel background color
                    if (themeData.reelBg) {
                        root.style.setProperty('--reel-bg-color', themeData.reelBg);
                    }
                    
                    // Apply title color
                    const title = document.querySelector('.animated-logo');
                    if (title && themeData.titleColor) {
                        title.style.color = themeData.titleColor;
                    }
                    
                    // Apply subtitle color
                    const subtitle = document.querySelector('.header p');
                    if (subtitle && themeData.subtitleColor) {
                        subtitle.style.color = themeData.subtitleColor;
                    }
                    
                    // Apply legend prize text color
                    const legendPrizes = document.querySelectorAll('.legend-prize');
                    legendPrizes.forEach(prizeText => {
                        if (themeData.prizeBoxText) {
                            prizeText.style.color = themeData.prizeBoxText;
                        }
                    });
                    
                    // Apply slot machine box background
                    const slotMachine = document.querySelector('.slot-machine');
                    if (slotMachine && themeData.slotBoxBg) {
                        slotMachine.style.background = themeData.slotBoxBg;
                    }
                    
                    // Apply page background color
                    if (themeData.pageBgColor) {
                        document.body.style.background = themeData.pageBgColor;
                    }
                    
                    // Apply reel frame color
                    const reelsContainer = document.querySelector('.reels-container');
                    if (reelsContainer && themeData.reelFrameColor) {
                        reelsContainer.style.background = themeData.reelFrameColor;
                    }
                    
                    // Apply spin button background and text
                    const spinBtn = document.querySelector('.spin-button');
                    if (spinBtn) {
                        if (themeData.spinBtnBg) {
                            spinBtn.style.background = `linear-gradient(135deg, ${themeData.spinBtnBg} 0%, ${themeData.spinBtnBg} 100%)`;
                        }
                        if (themeData.spinBtnText) {
                            spinBtn.style.color = themeData.spinBtnText;
                        }
                    }
                    
                    // Apply instruction text color
                    const infoText = document.getElementById('info-text');
                    if (infoText && themeData.instructionText) {
                        infoText.style.color = themeData.instructionText;
                    }
                }
            } catch (e) {
                console.log('Color theme loading error:', e.message);
            }
        }
        
        // Fill reel with symbols
        function fillReel(el, targetSymbol) {
            el.innerHTML = '';
            const symbolCount = 30;
            
            for (let i = 0; i < symbolCount; i++) {
                const div = document.createElement('div');
                div.className = 'reel-symbol';
                
                // Place target symbol in the middle (position 14-15)
                const symbol = (i === 14 && targetSymbol) 
                    ? targetSymbol 
                    : symbols[Math.floor(Math.random() * symbols.length)];
                
                if (symbol.startsWith('data:image')) {
                    const img = document.createElement('img');
                    img.src = symbol;
                    div.appendChild(img);
                } else {
                    div.textContent = symbol;
                }
                el.appendChild(div);
            }
        }
        
        // Create emoji rain effect using slot machine icons
        function createEmojiRain() {
            const emojiCount = 50;
            
            for (let i = 0; i < emojiCount; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.className = 'emoji-rain';
                    
                    // Random horizontal position
                    emoji.style.left = Math.random() * 100 + '%';
                    
                    // Random drift amount (sideways movement)
                    const drift = (Math.random() - 0.5) * 200; // -100px to +100px
                    emoji.style.setProperty('--drift', drift + 'px');
                    
                    // Random animation duration
                    emoji.style.animationDuration = (Math.random() * 1.5 + 2) + 's';
                    emoji.style.animationDelay = Math.random() * 0.5 + 's';
                    
                    // Use a random slot machine icon
                    const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                    
                    if (randomSymbol.startsWith('data:image')) {
                        const img = document.createElement('img');
                        img.src = randomSymbol;
                        emoji.appendChild(img);
                    } else {
                        // If it's an emoji text, show it
                        emoji.textContent = randomSymbol;
                        emoji.style.fontSize = '70px';
                    }
                    
                    document.body.appendChild(emoji);
                    
                    // Auto cleanup when animation ends
                    emoji.addEventListener('animationend', () => emoji.remove());
                }, i * 40);
            }
        }
        
        // Spin logic
        document.getElementById('spin-btn').onclick = async function() {
            getAudioCtx(); // Create/resume AudioContext HERE (direct user gesture)
            if (spinning) return;
            
            spinning = true;
            this.classList.add('disabled');
            
            const btnText = document.getElementById('btn-text');
            btnText.innerHTML = 'SPINNING <span class="spinner-icon">‚ö°</span>';
            document.getElementById('info-text').textContent = 'Good luck! üçÄ';
            
            // Use CACHED odds (pre-loaded on page load) - no server delay!
            const odds = cachedOdds;
            console.log('Using cached odds:', odds);
            
            // Use CACHED duration (pre-loaded on page load) - no server delay!
            const currentDuration = duration;
            console.log('Using cached duration:', currentDuration);
            
            // Determine outcome
            const r = Math.random() * 100;
            let result = 'NO_MATCH';
            if (r < odds.THREE_MATCH) {
                result = 'THREE_MATCH';
            } else if (r < odds.THREE_MATCH + odds.TWO_MATCH) {
                result = 'TWO_MATCH';
            }
            
            // Select symbols for outcome
            const baseSymbol = symbols[Math.floor(Math.random() * symbols.length)];
            const targets = [baseSymbol, baseSymbol, baseSymbol];
            
            if (result === 'TWO_MATCH') {
                targets[2] = symbols.find(s => s !== baseSymbol) || symbols[0];
            } else if (result === 'NO_MATCH') {
                targets[1] = symbols.find(s => s !== baseSymbol) || symbols[0];
                targets[2] = symbols.find(s => s !== baseSymbol && s !== targets[1]) || symbols[1];
            }
            
            // Track where the target symbol lands in each reel (changes each spin)
            const targetIndices = {};

            // Spin each reel with stagger
            [1, 2, 3].forEach(i => {
                const strip = document.getElementById('reel' + i);
                const reel = strip.closest('.reel');

                // Start spin after stagger delay (each reel starts 400ms after previous)
                setTimeout(() => {
                    // Get current Y position WITHOUT resetting ‚Äî icons stay exactly as-is
                    const matrix = new DOMMatrix(window.getComputedStyle(strip).transform);
                    const currentY = matrix.m42;

                    // Append new random symbols + target to the BOTTOM of the existing strip
                    // This way the currently visible icons never change/jump
                    const existingCount = strip.children.length;
                    const addCount = 35;
                    const targetIndexInNew = addCount - 14; // target near the end of new batch
                    targetIndices[i] = existingCount + targetIndexInNew;

                    for (let j = 0; j < addCount; j++) {
                        const div = document.createElement('div');
                        div.className = 'reel-symbol';
                        const isTarget = (j === targetIndexInNew);
                        const sym = (isTarget && targets[i - 1]) ? targets[i - 1] : symbols[Math.floor(Math.random() * symbols.length)];

                        if (sym && sym.startsWith('data:image')) {
                            const img = document.createElement('img');
                            img.src = sym;
                            div.appendChild(img);
                        } else {
                            div.textContent = sym || '?';
                        }
                        strip.appendChild(div);
                    }

                    // Keep current visual (no jump ‚Äî icons look exactly the same)
                    strip.style.transition = 'none';
                    strip.style.transform = `translateY(${currentY}px)`;

                    // Sound plays the moment reel 1 starts rolling
                    if (i === 1 && sounds.spin) {
                        sounds.spin.play(currentDuration);
                    }

                    reel.classList.add('active-spin');
                    strip.classList.add('spinning');

                    // rAF ensures new symbols are rendered before animating
                    requestAnimationFrame(() => {
                        requestAnimationFrame(() => {
                            const symbolHeight = strip.children[0].offsetHeight;
                            strip.style.transition = `transform ${currentDuration}s cubic-bezier(0.25, 0.1, 0.25, 1)`;
                            // Scroll down to land target symbol in the center
                            strip.style.transform = `translateY(${-(targetIndices[i] - 1) * symbolHeight}px)`;
                        });
                    });
                }, i * 400);

                // Remove active state when reel stops
                setTimeout(() => {
                    strip.classList.remove('spinning');
                    reel.classList.add('reveal-flash');
                    setTimeout(() => {
                        reel.classList.remove('active-spin');
                        setTimeout(() => {
                            reel.classList.remove('reveal-flash');
                        }, 500);
                    }, 100);
                }, (currentDuration * 1000) + (i * 400));
            });
            
            // Save button reference
            const button = this;
            
            // Show result
            setTimeout(() => {
                spinning = false;
                button.classList.remove('disabled');
                btnText.textContent = 'SPIN AGAIN';
                document.getElementById('info-text').textContent = 'Press SPIN to play!';
                
                // Highlight ONLY the matching symbols based on result
                if (result === 'THREE_MATCH') {
                    [1, 2, 3].forEach(i => {
                        const strip = document.getElementById('reel' + i);
                        const allSymbols = strip.querySelectorAll('.reel-symbol');
                        const idx = targetIndices[i];
                        if (allSymbols[idx]) {
                            allSymbols[idx].classList.add('winning');
                            setTimeout(() => allSymbols[idx].classList.remove('winning'), 1000);
                        }
                    });
                } else if (result === 'TWO_MATCH') {
                    [1, 2].forEach(i => {
                        const strip = document.getElementById('reel' + i);
                        const allSymbols = strip.querySelectorAll('.reel-symbol');
                        const idx = targetIndices[i];
                        if (allSymbols[idx]) {
                            allSymbols[idx].classList.add('winning');
                            setTimeout(() => allSymbols[idx].classList.remove('winning'), 1000);
                        }
                    });
                }
                
                // Show prize popup with actual icons
                const prizeConfig = prizes[result];
                const popup = document.getElementById('popup');
                const emojiContainer = popup.querySelector('.emoji');
                emojiContainer.innerHTML = '';
                
                let iconToShow;
                if (result === 'THREE_MATCH') {
                    iconToShow = targets[0];
                } else if (result === 'TWO_MATCH') {
                    iconToShow = targets[0];
                } else {
                    iconToShow = 'üòÖ';
                }
                
                if (iconToShow.startsWith('data:image')) {
                    const img = document.createElement('img');
                    img.src = iconToShow;
                    emojiContainer.appendChild(img);
                } else {
                    emojiContainer.textContent = iconToShow;
                }
                
                document.getElementById('popup-title').textContent = prizeConfig.title;
                document.getElementById('popup-message').textContent = prizeConfig.message;
                document.getElementById('popup-prize').textContent = prizeConfig.prize;
                popup.classList.add('show');
                
                // Play result sound
                if (result === 'THREE_MATCH' && sounds.jackpot) {
                    sounds.jackpot.play();
                } else if (result === 'TWO_MATCH' && sounds.win) {
                    sounds.win.play();
                } else if (sounds.lose) {
                    sounds.lose.play();
                }
                
                // Emoji rain ONLY for JACKPOT (all 3 matching)
                if (result === 'THREE_MATCH') {
                    createEmojiRain();
                }
                
                // Hide popup after delay
                setTimeout(() => popup.classList.remove('show'), 4000);

                // Trim old symbols from strips to prevent DOM growing unbounded
                // Keep only ~10 symbols around the winner, reset translateY silently
                [1, 2, 3].forEach(i => {
                    const strip = document.getElementById('reel' + i);
                    const tIdx = targetIndices[i];
                    if (tIdx == null) return;
                    const allSymbols = strip.querySelectorAll('.reel-symbol');
                    const symbolHeight = allSymbols[0]?.offsetHeight;
                    if (!symbolHeight) return;

                    const keepFrom = Math.max(0, tIdx - 4);
                    const keepTo = Math.min(allSymbols.length - 1, tIdx + 4);
                    const toKeep = [];
                    for (let k = keepFrom; k <= keepTo; k++) {
                        toKeep.push(allSymbols[k].cloneNode(true));
                    }

                    strip.style.transition = 'none';
                    strip.innerHTML = '';
                    toKeep.forEach(s => strip.appendChild(s));

                    // Winner is now at index (tIdx - keepFrom), re-center it silently
                    const newIdx = tIdx - keepFrom;
                    strip.style.transform = `translateY(${-(newIdx - 1) * symbolHeight}px)`;
                });
            }, (currentDuration * 1000) + 1200 + 700); // 1200ms = 3 reels * 400ms stagger
        }
        
        // Populate Prize Legend with actual symbols
        function populatePrizeLegend() {
            const legendContainer = document.getElementById('prize-legend');
            if (!legendContainer || symbols.length === 0) return;
            
            legendContainer.innerHTML = '';
            
            // Get different symbols for display
            const symbol1 = symbols[0];
            const symbol2 = symbols.length > 1 ? symbols[1] : symbols[0];
            const symbol3 = symbols.length > 2 ? symbols[2] : (symbols.length > 1 ? symbols[1] : symbols[0]);
            
            // Helper function to create symbol element
            function createSymbolElement(symbol) {
                const symbolDiv = document.createElement('div');
                symbolDiv.className = 'legend-symbol';
                
                if (symbol.startsWith('data:image')) {
                    const img = document.createElement('img');
                    img.src = symbol;
                    symbolDiv.appendChild(img);
                } else {
                    symbolDiv.textContent = symbol;
                }
                
                return symbolDiv;
            }
            
            // Create legend items based on prizes configuration
            const legendItems = [
                {
                    symbols: [symbol1, symbol1, symbol1],
                    label: prizes.THREE_MATCH.prize
                },
                {
                    symbols: [symbol2, symbol2, symbol3],
                    label: prizes.TWO_MATCH.prize
                },
                {
                    symbols: [symbol1, symbol2, symbol3],
                    label: 'No Prize'
                }
            ];
            
            legendItems.forEach(item => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                
                // Create symbols display
                const symbolsDiv = document.createElement('div');
                symbolsDiv.className = 'legend-symbols';
                
                item.symbols.forEach(symbol => {
                    symbolsDiv.appendChild(createSymbolElement(symbol));
                });
                
                // Create arrow
                const arrow = document.createElement('span');
                arrow.className = 'legend-arrow';
                arrow.textContent = '‚Üí';
                
                // Create prize text
                const prizeText = document.createElement('span');
                prizeText.className = 'legend-prize';
                prizeText.textContent = item.label;
                
                // Style "No Prize" differently
                if (item.label === 'No Prize') {
                    prizeText.style.color = 'rgba(255, 255, 255, 0.5)';
                    prizeText.style.textDecoration = 'line-through';
                }
                
                // Assemble legend item
                legendItem.appendChild(symbolsDiv);
                legendItem.appendChild(arrow);
                legendItem.appendChild(prizeText);
                
                legendContainer.appendChild(legendItem);
            });
        }
        
        // Split text into individual characters for animation
        function splitTextToChars(selector) {
            const el = document.querySelector(selector);
            if (!el) return [];
            const text = el.textContent.trim();
            el.innerHTML = '';
            const chars = [];
            for (const ch of text) {
                const span = document.createElement('span');
                span.className = 'char';
                span.textContent = ch === ' ' ? '\u00A0' : ch;
                el.appendChild(span);
                chars.push(span);
            }
            return chars;
        }
        

        // Load and apply layout designs
        async function loadLayouts() {
            try {
                // Load legend layout from SERVER ONLY
                const legendPromise = fetchFromServer('/api/load/layout-legend');
                const legendTimeout = new Promise(resolve => setTimeout(() => resolve(null), 800));
                const legendLayout = await Promise.race([legendPromise, legendTimeout]);
                
                if (legendLayout) {
                    document.documentElement.style.setProperty('--legend-layout', `url(${legendLayout})`);
                    document.querySelector('.prize-legend').classList.add('has-layout');
                }
                
                // Load machine layout from SERVER ONLY
                const machinePromise = fetchFromServer('/api/load/layout-machine');
                const machineTimeout = new Promise(resolve => setTimeout(() => resolve(null), 800));
                const machineLayout = await Promise.race([machinePromise, machineTimeout]);
                
                if (machineLayout) {
                    document.documentElement.style.setProperty('--machine-layout', `url(${machineLayout})`);
                    document.querySelector('.slot-machine').classList.add('has-layout');
                }
            } catch (e) {
                console.log('Failed to load layouts:', e.message);
            }
        }
        
        
        
        
        // Load full template if enabled
        async function loadFullTemplate() {
            try {
                // Check if template mode is enabled - SERVER ONLY
                const modePromise = fetchFromServer('/api/load/template-mode');
                const modeTimeout = new Promise(resolve => setTimeout(() => resolve(null), 2000));
                const templateMode = await Promise.race([modePromise, modeTimeout]);
                
                if (templateMode === 'true') {
                    // Load the template image from SERVER ONLY
                    const templatePromise = fetchFromServer('/api/load/full-template');
                    const templateTimeout = new Promise(resolve => setTimeout(() => resolve(null), 800));
                    const templateImage = await Promise.race([templatePromise, templateTimeout]);
                    
                    if (templateImage) {
                        // Apply template
                        document.body.style.backgroundImage = `url(${templateImage})`;
                        document.body.classList.add('template-mode');
                        console.log('Full template mode enabled');
                    }
                }
            } catch (e) {
                console.log('Failed to load template:', e.message);
            }
        }

                // Initialize - Load everything in parallel for faster loading
        window.onload = async () => {
            // iOS-specific fixes for mobile
            if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                // Prevent elastic scrolling on iOS
                document.body.addEventListener('touchmove', (e) => {
                    if (e.target === document.body || e.target === document.documentElement) {
                        e.preventDefault();
                    }
                }, { passive: false });
                
                // Prevent pinch zoom
                document.addEventListener('gesturestart', (e) => {
                    e.preventDefault();
                });
                
                // Add iOS safe area padding
                if (window.innerHeight > window.innerWidth) {
                    document.body.style.paddingTop = 'env(safe-area-inset-top)';
                    document.body.style.paddingBottom = 'env(safe-area-inset-bottom)';
                }
            }
            

            // Load all settings simultaneously instead of waiting for each one
            await Promise.all([
                loadSettings(),
                loadFullTemplate(),
                loadLayouts(),
                initSounds()
            ]);
            
            // Populate prize legend with actual symbols
            populatePrizeLegend();
            
            // Animate the Chickilicious logo
            const logoChars = splitTextToChars('.animated-logo');
            if (logoChars.length > 0) {
                anime.timeline({ loop: true })
                    .add({
                        targets: '.animated-logo .char',
                        translateY: [
                            { value: '-1rem', duration: 600, easing: 'easeOutExpo' }, 
                            { value: '0rem', duration: 800, delay: 100, easing: 'easeOutBounce' }
                        ],
                        rotate: ['-1turn', '0turn'],
                        delay: anime.stagger(50), 
                        easing: 'easeInOutCirc'
                    })
                    .add({ }, 2500); 
            }
            
            // Fill all reels with initial symbols
            [1, 2, 3].forEach(i => {
                fillReel(document.getElementById('reel' + i));
            });
            
            // Mobile-friendly fullscreen toggle
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            let mobileFullscreenActive = false;
            
            fullscreenBtn.addEventListener('click', () => {
                // On mobile devices, use CSS-based fullscreen (works on iOS)
                if (isMobile && window.innerWidth <= 768) {
                    mobileFullscreenActive = !mobileFullscreenActive;
                    
                    if (mobileFullscreenActive) {
                        document.body.classList.add('mobile-fullscreen');
                        fullscreenBtn.textContent = '‚úï';
                        
                        // Lock screen orientation to portrait on mobile if supported
                        if (screen.orientation && screen.orientation.lock) {
                            screen.orientation.lock('portrait').catch(() => {
                                // Orientation lock not supported, continue anyway
                            });
                        }
                        
                        // Try native fullscreen as well (works on some Android devices)
                        const elem = document.documentElement;
                        if (elem.requestFullscreen) {
                            elem.requestFullscreen().catch(() => {});
                        } else if (elem.webkitRequestFullscreen) {
                            elem.webkitRequestFullscreen().catch(() => {});
                        }
                    } else {
                        document.body.classList.remove('mobile-fullscreen');
                        fullscreenBtn.textContent = '‚õ∂';
                        
                        // Unlock orientation
                        if (screen.orientation && screen.orientation.unlock) {
                            screen.orientation.unlock();
                        }
                        
                        // Exit native fullscreen if active
                        if (document.exitFullscreen) {
                            document.exitFullscreen().catch(() => {});
                        } else if (document.webkitExitFullscreen) {
                            document.webkitExitFullscreen().catch(() => {});
                        }
                    }
                } else {
                    // Desktop: Use native fullscreen API
                    if (!document.fullscreenElement && 
                        !document.webkitFullscreenElement && 
                        !document.mozFullScreenElement &&
                        !document.msFullscreenElement) {
                        // Enter fullscreen
                        const elem = document.documentElement;
                        if (elem.requestFullscreen) {
                            elem.requestFullscreen();
                        } else if (elem.webkitRequestFullscreen) {
                            elem.webkitRequestFullscreen();
                        } else if (elem.mozRequestFullScreen) {
                            elem.mozRequestFullScreen();
                        } else if (elem.msRequestFullscreen) {
                            elem.msRequestFullscreen();
                        }
                        fullscreenBtn.textContent = '‚úï';
                    } else {
                        // Exit fullscreen
                        if (document.exitFullscreen) {
                            document.exitFullscreen();
                        } else if (document.webkitExitFullscreen) {
                            document.webkitExitFullscreen();
                        } else if (document.mozCancelFullScreen) {
                            document.mozCancelFullScreen();
                        } else if (document.msExitFullscreen) {
                            document.msExitFullscreen();
                        }
                        fullscreenBtn.textContent = '‚õ∂';
                    }
                }
            });
            
            // Update button icon when fullscreen changes (desktop only)
            document.addEventListener('fullscreenchange', updateFullscreenButton);
            document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
            document.addEventListener('mozfullscreenchange', updateFullscreenButton);
            document.addEventListener('MSFullscreenChange', updateFullscreenButton);
            
            function updateFullscreenButton() {
                // Don't update on mobile - mobile uses CSS fullscreen
                if (!isMobile || window.innerWidth > 768) {
                    if (document.fullscreenElement || 
                        document.webkitFullscreenElement || 
                        document.mozFullScreenElement ||
                        document.msFullscreenElement) {
                        fullscreenBtn.textContent = '‚úï';
                    } else {
                        fullscreenBtn.textContent = '‚õ∂';
                    }
                }
            }
            
            // Handle hardware back button on Android in fullscreen
            window.addEventListener('popstate', () => {
                if (mobileFullscreenActive) {
                    document.body.classList.remove('mobile-fullscreen');
                    fullscreenBtn.textContent = '‚õ∂';
                    mobileFullscreenActive = false;
                }
            });
            
            // Hide loading screen immediately after content loads
            document.getElementById('loading').classList.add('hidden');
        };
    </script>
</body>
</html>